{"version":3,"sources":["room.js"],"names":["cc","Class","extends","Component","properties","out_bt","Button","voice_bt","talk_bt","ready_bt","no_ready_bt","play_bt","prefab_poker","default","type","Prefab","layout","Layout","poker_up","Sprite","poker_left","poker_down","poker_right","onLoad","console","log","util","require","curr_poker_num","curr_poker","node","on","on_out_bt","load_pokers","that","pokers","loader","loadResDir","SpriteFrame","err","ress","p","name","setPokers","pokersNode","instantiate","img","getChildByName","getComponent","spriteFrame","poker","parent","Node","EventType","TOUCH_START","onPoker","TOUCH_MOVE","event","currentTarget","target","curr","getPosition","y","setPosition","arrayDel","indexOf","num","push","rm_poker","shift","netControl","global","send","table","sit","director","loadScene","onMessage","obj","start"],"mappings":"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","file":"room.js","sourceRoot":"../../../../assets/scripts","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        out_bt : cc.Button,\n        voice_bt : cc.Button,\n        talk_bt : cc.Button,\n        ready_bt : cc.Button,\n        no_ready_bt : cc.Button,\n        play_bt : cc.Button,\n        prefab_poker: {\n            default: null,\n            type: cc.Prefab\n        },\n        layout : cc.Layout,\n        poker_up : cc.Sprite,\n        poker_left : cc.Sprite,\n        poker_down : cc.Sprite,\n        poker_right : cc.Sprite\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        console.log('room onLoad');\n\n        this.util = require('./util/util');\n        //绑定消息事件\n        // this.msssageFire=onfire.on(\"onmessage\",this.onMessage.bind(this));\n\n        //设置当前能选几张牌\n        this.curr_poker_num = 4;\n        //当前选中的牌\n        this.curr_poker = [];\n         \n         //按钮事件\n        this.out_bt.node.on('click',this.on_out_bt,this);\n\n        //加载扑克牌图片资源\n        this.load_pokers();\n\n    },\n    //加载扑克牌资源\n    load_pokers(){\n\n        console.log('room load_pokers');\n\n        var that = this;\n        that.pokers = {};\n        cc.loader.loadResDir('pokers', cc.SpriteFrame, function (err, ress) {\n            for(var p of ress){\n                that.pokers[p.name] = p;\n            }\n            that.setPokers();\n        });\n        console.log(that.pokers );\n\n        \n    },\n    //设置显示的牌\n    setPokers(){\n        console.log('room setPokers');\n\n        //设置当前玩家手中的牌\n        var pokers = [414,413,412,411,410,409,408,407,406,405,404,403,402];\n        for(var p of pokers){\n            var pokersNode = cc.instantiate(this.prefab_poker);\n            var img = pokersNode.getChildByName('img');\n            img.getComponent(cc.Sprite).spriteFrame = this.pokers[p];\n            img.poker = p;\n            pokersNode.parent = this.layout.node;\n            img.on(cc.Node.EventType.TOUCH_START, this.onPoker, this);\n            img.on(cc.Node.EventType.TOUCH_MOVE, this.onPoker, this);\n        }\n\n        //设置每个玩家出的牌\n        // var up_poker = 114;\n        // var down_poker = 214;\n        // var left_poker = 314;\n        // var right_poker = 414;\n        // this.poker_up.spriteFrame = this.pokers[up_poker];\n        // this.poker_down.spriteFrame = this.pokers[down_poker];\n        // this.poker_left.spriteFrame = this.pokers[left_poker];\n        // this.poker_right.spriteFrame = this.pokers[right_poker];\n\n    },\n    //牌事件\n    onPoker(event){\n        console.log('room onPoker');\n\n\n        // console.log(event);\n        if(event.type == 'touchmove'){\n            if(event.currentTarget.poker != event.target.poker){\n                console.log(\"diff\");\n                console.log(currentTarget);\n                console.log(target);\n            }\n            return \n        }\n        console.log(event);\n        //点击的节点\n        var curr = event.currentTarget;\n        //移动牌\n        var p = curr.getPosition();\n        if(p.y == 25){\n            curr.setPosition(0,0);\n            //删除取消的牌\n            this.curr_poker = this.util.arrayDel(this.curr_poker, this.curr_poker.indexOf(curr) );\n        }else{\n            //根据选牌数删除多余的牌\n            curr.setPosition(0,25);\n            var num = this.curr_poker.push(curr);\n            if(num > this.curr_poker_num){\n                var rm_poker = this.curr_poker.shift();\n                rm_poker.setPosition(0,0);\n            }\n        }\n    },\n\n    //退出按钮返回到大厅\n    on_out_bt(){\n        var netControl = require('./util/NetControl');\n        var global = require('./global');\n\n        netControl.send('{\"method\":\"out\",\"roomId\":\"'+global.table+'\",\"sit\":\"'+global.sit+'\",\"playerId\":\"'+global.name+'\"}');\n        cc.director.loadScene('hall');\n    },\n\n    onMessage:function(obj){\n        console.log('room onMessage');\n        console.log(obj);\n        // onfire.clear();\n    },\n\n    start () {\n        \n    },\n\n    // update (dt) {},\n});\n"]}